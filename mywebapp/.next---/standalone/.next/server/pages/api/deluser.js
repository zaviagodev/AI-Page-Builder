"use strict";(()=>{var e={};e.id=7419,e.ids=[7419],e.modules={1841:e=>{e.exports=require("@aws-sdk/client-s3")},8013:e=>{e.exports=require("mongodb")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},4858:(e,t,s)=>{s.r(t),s.d(t,{config:()=>_,default:()=>f,routeModule:()=>w});var r={};s.r(r),s.d(r,{default:()=>m});var a=s(1802),n=s(7153),o=s(6249),i=s(3919),u=s(614),c=s(7147),l=s.n(c),d=s(1017),p=s.n(d),S=s(747);async function emptyS3Directory(e,t){S.S.listObjectsV2({Bucket:e,Prefix:t},function(t,s){t||0===s.Contents.length||s.Contents.map(({Key:t})=>{S.S.deleteObject({Bucket:e,Key:t},function(e,t){e&&console.log(e)})})})}async function handler(e,t){let s=await (0,u.getToken)({req:e});if(!s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let r=s.name;if("admin"!==r){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}if("POST"===e.method){let s;let r=JSON.parse(e.body),a=r.username;if("admin"===a){t.status(200).json({ok:!0,status:422,error:"Admin user cannot be deleted."});return}try{s=await (0,i.T)()}catch(e){t.status(200).json({ok:!0,status:500,error:"Connecting to the database failed."});return}try{let e=s.db(),r={username:a};if(await e.collection("users").deleteOne(r),await e.collection("pages").deleteMany(r),await e.collection("pages_published").deleteMany(r),process.env.SPACES_URL)await emptyS3Directory(process.env.SPACES_BUCKET,`${a}/`);else{let e=p().join(process.env.WEB_ASSETS_PATH,"uploads/"+a);l().existsSync(e)&&l().rmdirSync(e,{recursive:!0})}await s.close(),t.status(200).json({ok:!0,status:200})}catch(e){await s.close(),t.status(200).json({ok:!0,status:500,error:"Something went wrong."})}}}let m=handler,f=(0,o.l)(r,"default"),_=(0,o.l)(r,"config"),w=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/deluser",pathname:"/api/deluser",bundlePath:"",filename:""},userland:r})},747:(e,t,s)=>{s.d(t,{S:()=>a});var r=s(1841);let a=new r.S3({endpoint:process.env.SPACES_ENDPOINT,region:"us-east-1",credentials:{accessKeyId:process.env.SPACES_KEY,secretAccessKey:process.env.SPACES_SECRET}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222,3919],()=>__webpack_exec__(4858));module.exports=s})();