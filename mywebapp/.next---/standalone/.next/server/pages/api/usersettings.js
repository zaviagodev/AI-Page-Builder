"use strict";(()=>{var e={};e.id=4853,e.ids=[4853],e.modules={8013:e=>{e.exports=require("mongodb")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2202:(e,t,a)=>{a.r(t),a.d(t,{config:()=>m,default:()=>c,routeModule:()=>w});var s={};a.r(s),a.d(s,{default:()=>l});var r=a(1802),i=a(7153),n=a(6249),o=a(3919),u=a(614),d=a(9059);async function handler(e,t){let a=await (0,u.getToken)({req:e});if(!a){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let s=a.name;if("admin"!==s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}if("POST"===e.method){let a,s;let r=JSON.parse(e.body),i=r.username,n=r.email,u=r.newpassword,l=r.domainName,c=r.inactive;if(!n||!n.includes("@")){t.status(200).json({ok:!0,status:422,error:"Invalid email format."});return}let m=!1;""!==u&&(a=await (0,d.c)(u),m=!0);try{s=await (0,o.T)()}catch(e){t.status(200).json({ok:!0,status:500,error:"Connecting to the database failed."});return}try{let e=s.db(),r=await e.collection("users").findOne({username:i});if(r){let t;t=m?"admin"===i?{$set:{email:n,password:a,inactive:c}}:{$set:{email:n,password:a,inactive:c,domainName:l}}:"admin"===i?{$set:{email:n,inactive:c}}:{$set:{email:n,inactive:c,domainName:l}},await e.collection("users").updateOne({username:i},t)}await s.close(),t.status(200).json({ok:!0,status:200,email:n})}catch(e){await s.close(),t.status(200).json({ok:!0,status:500,error:"Something went wrong."})}}}let l=handler,c=(0,n.l)(s,"default"),m=(0,n.l)(s,"config"),w=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/usersettings",pathname:"/api/usersettings",bundlePath:"",filename:""},userland:s})},9059:(e,t,a)=>{a.d(t,{c:()=>hashPassword,G:()=>verifyPassword});let s=require("bcryptjs");async function hashPassword(e){let t=await (0,s.hash)(e,12);return t}async function verifyPassword(e,t){let a=await (0,s.compare)(e,t);return a}}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,3919],()=>__webpack_exec__(2202));module.exports=a})();