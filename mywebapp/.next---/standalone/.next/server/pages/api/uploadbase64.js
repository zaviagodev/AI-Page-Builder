"use strict";(()=>{var e={};e.id=8337,e.ids=[8337],e.modules={1841:e=>{e.exports=require("@aws-sdk/client-s3")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7441:e=>{e.exports=require("sharp")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},4612:(e,t,s)=>{s.r(t),s.d(t,{config:()=>b,default:()=>S,routeModule:()=>j});var r={};s.r(r),s.d(r,{default:()=>w});var a=s(1802),n=s(7153),i=s(6249),o=s(614),u=s(7147),p=s.n(u),l=s(1017),f=s.n(l),d=s(1841),g=s(747),c=s(7441),m=s.n(c);async function handler(e,t){let s=await (0,o.getToken)({req:e});if(!s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let r=s.name;if("POST"===e.method){let s=e.body.image,a=e.body.filename,n=new Date().toLocaleDateString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"});if(process.env.SPACES_URL){let e=new Buffer.from(s.replace(/^data:image\/\w+;base64,/,""),"base64"),i=f().extname(a).toLowerCase();if(".jpeg"!==i&&".jpg"!==i&&".png"!==i&&".gif"!==i&&".mp4"!==i){t.status(500).json({ok:!0,status:500,error:"File type not allowed."});return}let o="application/octet-stream";".jpeg"===i||".jpg"===i?o="image/jpeg":".png"===i?o="image/png":".gif"===i?o="image/gif":".mp4"===i&&(o="video/mp4");let u=e;if(".jpeg"===i||".jpg"===i){let e=new Buffer.from(s,"base64");u=await m()(e).resize(1920,1920,{fit:m().fit.inside,withoutEnlargement:!0}).jpeg({quality:70,progressive:!0,force:!1}).toBuffer()}let p={Bucket:process.env.SPACES_BUCKET,ACL:"public-read",Key:`${r}/${n}/${a}`,Body:u,ContentEncoding:"base64",ContentType:o};try{if(await g.S.send(new d.PutObjectCommand(p)),".jpeg"===i||".jpg"===i||".png"===i||".gif"===i||".webp"===i||".webm"===i){let e=new Buffer.from(s,"base64"),t=await m()(e).resize(100,100,{fit:m().fit.inside,withoutEnlargement:!0}).toBuffer();await g.S.send(new d.PutObjectCommand({Bucket:process.env.SPACES_BUCKET,ACL:"public-read",Key:`${r}/${n}/thumbs/${a}`,Body:t,ContentType:o}))}t.status(200).json({ok:!0,status:200,url:process.env.SPACES_URL+"/"+r+"/"+n+"/"+a})}catch(e){t.status(500).json({ok:!0,status:500,error:"Something went wrong."})}}else{let e=f().extname(a).toLowerCase(),i=f().join(process.env.WEB_ASSETS_PATH,"uploads/"+r+"/"+n);p().existsSync(i)||p().mkdirSync(i,{recursive:!0}),p().existsSync(i+"/thumbs")||p().mkdirSync(i+"/thumbs",{recursive:!0});let o=s;if(".jpeg"===e||".jpg"===e){let e=new Buffer.from(s,"base64");o=await m()(e).resize(1920,1920,{fit:m().fit.inside,withoutEnlargement:!0}).jpeg({quality:70,progressive:!0,force:!1}).toBuffer()}p().writeFile(i+"/"+a,o,"base64",async o=>{if(o){t.status(500).json({ok:!0,status:500,error:"Something went wrong."});return}if(".jpeg"===e||".jpg"===e||".png"===e||".gif"===e||".webp"===e||".webm"===e){let e=new Buffer.from(s,"base64"),o=await m()(e).resize(100,100,{fit:m().fit.inside,withoutEnlargement:!0}).toBuffer();p().writeFile(i+"/thumbs/"+a,o,"base64",e=>{if(e){t.status(500).json({ok:!0,status:500,error:"Something went wrong."});return}t.status(200).json({ok:!0,status:200,url:process.env.WEB_ASSETS_URL+"/uploads/"+r+"/"+n+"/"+a})})}else t.status(200).json({ok:!0,status:200,url:process.env.WEB_ASSETS_URL+"/uploads/"+r+"/"+n+"/"+a})})}}}let w=handler,S=(0,i.l)(r,"default"),b=(0,i.l)(r,"config"),j=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/uploadbase64",pathname:"/api/uploadbase64",bundlePath:"",filename:""},userland:r})},747:(e,t,s)=>{s.d(t,{S:()=>a});var r=s(1841);let a=new r.S3({endpoint:process.env.SPACES_ENDPOINT,region:"us-east-1",credentials:{accessKeyId:process.env.SPACES_KEY,secretAccessKey:process.env.SPACES_SECRET}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222],()=>__webpack_exec__(4612));module.exports=s})();