"use strict";(()=>{var e={};e.id=1610,e.ids=[1610],e.modules={1841:e=>{e.exports=require("@aws-sdk/client-s3")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},491:(e,t,s)=>{s.r(t),s.d(t,{config:()=>w,default:()=>g,routeModule:()=>_});var n={};s.r(n),s.d(n,{default:()=>m});var r=s(1802),a=s(7153),o=s(6249),i=s(614),u=s(7147),d=s.n(u),l=s(1017),c=s.n(l),p=s(1841),S=s(747);async function handler(e,t){let s=await (0,i.getToken)({req:e});if(!s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let n=s.name;if("POST"===e.method){let s=JSON.parse(e.body),r=s.filename,a=s.dateAdded;if(process.env.SPACES_URL){let e={Bucket:process.env.SPACES_BUCKET,Key:`${n}/${a}/${r}`};try{await S.S.send(new p.DeleteObjectCommand(e));let s=c().extname(r).toLowerCase();(".jpeg"===s||".jpg"===s||".png"===s||".gif"===s)&&await S.S.send(new p.DeleteObjectCommand({Bucket:process.env.SPACES_BUCKET,Key:`${n}/${a}/thumbs/${r}`})),t.status(200).json({ok:!0,status:200})}catch(e){t.status(500).json({ok:!0,status:500,error:"Something went wrong."})}}else{let e=c().join(process.env.WEB_ASSETS_PATH,"uploads/"+n);return new Promise((s,n)=>{d().unlink(e+"/"+a+"/"+r,n=>{if(n){t.status(500).json({ok:!0,status:500,error:"Something went wrong."}),s();return}let o=c().extname(r).toLowerCase();".jpeg"===o||".jpg"===o||".png"===o||".gif"===o?d().unlink(e+"/"+a+"/thumbs/"+r,n=>{0==d().readdirSync(e+"/"+a+"/thumbs/").length&&(d().rmdirSync(e+"/"+a+"/thumbs"),d().rmdirSync(e+"/"+a)),t.status(200).json({ok:!0,status:200}),s()}):(t.status(200).json({ok:!0,status:200}),s())})})}}}let m=handler,g=(0,o.l)(n,"default"),w=(0,o.l)(n,"config"),_=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/deletefile",pathname:"/api/deletefile",bundlePath:"",filename:""},userland:n})},747:(e,t,s)=>{s.d(t,{S:()=>r});var n=s(1841);let r=new n.S3({endpoint:process.env.SPACES_ENDPOINT,region:"us-east-1",credentials:{accessKeyId:process.env.SPACES_KEY,secretAccessKey:process.env.SPACES_SECRET}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222],()=>__webpack_exec__(491));module.exports=s})();