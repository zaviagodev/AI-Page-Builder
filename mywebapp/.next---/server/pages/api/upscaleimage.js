"use strict";(()=>{var e={};e.id=9207,e.ids=[9207],e.modules={1841:e=>{e.exports=require("@aws-sdk/client-s3")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7441:e=>{e.exports=require("sharp")},9648:e=>{e.exports=import("axios")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},756:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>p});var s=r(1802),n=r(7153),i=r(6249),o=r(17),u=e([o]);o=(u.then?(await u)():u)[0];let c=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/upscaleimage",pathname:"/api/upscaleimage",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},17:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>S});var s=r(614),n=r(7147),i=r.n(n),o=r(1017),u=r.n(o),c=r(9648),l=r(1841),p=r(747),d=r(7441),m=r.n(d),f=e([c]);async function handler(e,t){let r=await (0,s.getToken)({req:e});if(!r){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let a=r.name;if("POST"!==e.method)return;let{image:n,folder_path:o}=e.body,d=process.env.GETIMG_API_KEY,f=JSON.stringify({model:"real-esrgan-4x",image:n,scale:4,output_format:"jpeg"}),S={headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}},g=await c.default.post("https://api.getimg.ai/v1/enhacements/upscale",f,S);if(g.data.error)t.json({error:"Something went wrong."});else{let e=new Date().toLocaleDateString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"}),r=g.data.image,s="image/jpeg",n=new Buffer.from(r.replace(/^data:image\/\w+;base64,/,""),"base64"),o=function(e){let t=function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="";for(let e=0;e<5;e++){let e=Math.floor(Math.random()*t.length);r+=t.charAt(e)}return r}(0);return e?`ai-${t}-${e}`:`ai-${t}`}("lg")+".jpg";if(!process.env.SPACES_URL)return new Promise((s,n)=>{let c=u().join(process.env.WEB_ASSETS_PATH,"uploads/"+a+"/"+e);i().existsSync(c)||i().mkdirSync(c,{recursive:!0}),i().existsSync(c+"/thumbs")||i().mkdirSync(c+"/thumbs",{recursive:!0}),i().writeFile(c+"/"+o,r,"base64",async n=>{if(n){t.status(500).json({ok:!0,status:500,error:"Something went wrong."}),s();return}let u=new Buffer.from(r,"base64"),l=await m()(u).resize(100,100,{fit:m().fit.inside,withoutEnlargement:!0}).toBuffer();i().writeFile(c+"/thumbs/"+o,l,"base64",r=>{if(r){t.status(500).json({ok:!0,status:500,error:"Something went wrong."}),s();return}let n=process.env.WEB_ASSETS_URL+"/uploads/"+a+"/"+e+"/"+o;t.status(200).json({ok:!0,status:200,url:n}),s()})})});{let i={Bucket:process.env.SPACES_BUCKET,ACL:"public-read",Key:`${a}/${e}/${o}`,Body:n,ContentEncoding:"base64",ContentType:s};try{await p.S.send(new l.PutObjectCommand(i));let n=new Buffer.from(r,"base64"),u=await m()(n).resize(100,100,{fit:m().fit.inside,withoutEnlargement:!0}).toBuffer();await p.S.send(new l.PutObjectCommand({Bucket:process.env.SPACES_BUCKET,ACL:"public-read",Key:`${a}/${e}/thumbs/${o}`,Body:u,ContentType:s})),t.status(200).json({ok:!0,status:200,url:process.env.SPACES_URL+"/"+a+"/"+e+"/"+o})}catch(e){t.status(500).json({ok:!0,status:500,error:"Something went wrong."})}}}}c=(f.then?(await f)():f)[0];let S=handler;a()}catch(e){a(e)}})},747:(e,t,r)=>{r.d(t,{S:()=>s});var a=r(1841);let s=new a.S3({endpoint:process.env.SPACES_ENDPOINT,region:"us-east-1",credentials:{accessKeyId:process.env.SPACES_KEY,secretAccessKey:process.env.SPACES_SECRET}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222],()=>__webpack_exec__(756));module.exports=r})();