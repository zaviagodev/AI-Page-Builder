"use strict";(()=>{var e={};e.id=6297,e.ids=[6297],e.modules={1841:e=>{e.exports=require("@aws-sdk/client-s3")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},3376:(e,t,s)=>{s.r(t),s.d(t,{config:()=>_,default:()=>f,routeModule:()=>h});var r={};s.r(r),s.d(r,{default:()=>handler});var n=s(1802),a=s(7153),i=s(6249),o=s(614),u=s(7147),d=s.n(u),l=s(1017),c=s.n(l),p=s(1841),S=s(747);async function handler(e,t){let s=await (0,o.getToken)({req:e});if(!s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let r=s.name;if(!process.env.SPACES_URL)return new Promise((e,s)=>{let n=c().join(process.env.WEB_ASSETS_PATH,"uploads/"+r),a=[];d().existsSync(n)||d().mkdirSync(n,{recursive:!0}),d().readdir(n,(s,i)=>{if(s){t.status(200).json({ok:!0,status:500,error:"Something went wrong."}),e();return}let o=i.filter(e=>{if(d().lstatSync(c().join(n,e)).isDirectory())return!0});o.sort().reverse(),o.forEach(e=>{d().readdirSync(c().join(n,e)).forEach(t=>{if("thumbs"!==t){let s={};s.filename=t,s.added=e,a.push(s)}})}),t.status(200).json({ok:!0,status:200,files:a,path:process.env.WEB_ASSETS_URL+"/uploads/"+r}),e()})});{let e={Bucket:process.env.SPACES_BUCKET,Prefix:r};try{let s=[],n=await S.S.send(new p.ListObjectsCommand(e));n.Contents&&(n.Contents.sort().reverse(),n.Contents.forEach(e=>{let t=e.Key.replace(r+"/","").split("/")[0],n={};e.Key.split("/").length>2&&(n.filename=e.Key.replace(r+`/${t}/`,""),n.added=e.Key.replace(r+"/","").split("/")[0],-1===e.Key.indexOf("/thumbs/")&&s.push(n))})),t.status(200).json({ok:!0,status:200,files:s,path:process.env.SPACES_URL+"/"+r})}catch(e){t.status(200).json({ok:!0,status:500,error:"Something went wrong."})}}}let f=(0,i.l)(r,"default"),_=(0,i.l)(r,"config"),h=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/readfiles",pathname:"/api/readfiles",bundlePath:"",filename:""},userland:r})},747:(e,t,s)=>{s.d(t,{S:()=>n});var r=s(1841);let n=new r.S3({endpoint:process.env.SPACES_ENDPOINT,region:"us-east-1",credentials:{accessKeyId:process.env.SPACES_KEY,secretAccessKey:process.env.SPACES_SECRET}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222],()=>__webpack_exec__(3376));module.exports=s})();