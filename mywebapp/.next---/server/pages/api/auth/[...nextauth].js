"use strict";(()=>{var e={};e.id=3748,e.ids=[3748],e.modules={8013:e=>{e.exports=require("mongodb")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},4828:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>u,default:()=>c,routeModule:()=>d});var i=t(1802),o=t(7153),s=t(6249),n=t(8417),l=e([n]);n=(l.then?(await l)():l)[0];let c=(0,s.l)(n,"default"),u=(0,s.l)(n,"config"),d=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/[...nextauth]",pathname:"/api/auth/[...nextauth]",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},8417:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{authOptions:()=>h,default:()=>w});var i=t(3919),o=t(9059),s=t(3227),n=t.n(s),l=t(7449),c=t.n(l),u=t(9648),d=e([u]);u=(d.then?(await d)():d)[0];let h={secret:process.env.NEXTAUTH_SECRET,session:{jwt:!0,maxAge:2592e3},providers:[c()({async authorize(e){let a;try{a=await (0,i.T)()}catch(e){throw Error("Connecting to the database failed.")}let t=a.db();if(e.token)try{let i=await u.default.post("https://hosting.zaviago.com/api/method/press.api.account.get",{},{headers:{Authorization:`Bearer ${e.token}`}});var r=i?.data?.message?.user,s=r?.email;r?.full_name;let n=await t.collection("users").findOne({email:s});if(n){let e={name:n.username,email:n.email};return e}{let r=await (0,o.c)(e.token);await t.collection("users").insertOne({username:s,email:s,password:r}),await a.close();let i={name:n.username,email:n.email};return i}}catch(e){throw console.error(e),Error(e)}let n=await t.collection("users").findOne({email:e.email});if(!n)throw await a.close(),Error("Sorry, we couldn't log you in. Please check that you have entered the correct account details.");if(n.inactive)throw await a.close(),Error("Sorry, we couldn't log you in.");let l=await (0,o.G)(e.password,n.password);if(!l)throw await a.close(),Error("Oops! The password you entered is incorrect. Please try again.");await a.close();let c={name:n.username,email:n.email};return c}})]},w=n()(h);r()}catch(e){r(e)}})},9059:(e,a,t)=>{t.d(a,{c:()=>hashPassword,G:()=>verifyPassword});let r=require("bcryptjs");async function hashPassword(e){let a=await (0,r.hash)(e,12);return a}async function verifyPassword(e,a){let t=await (0,r.compare)(e,a);return t}}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222,3919],()=>__webpack_exec__(4828));module.exports=t})();