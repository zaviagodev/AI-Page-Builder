"use strict";(()=>{var e={};e.id=7011,e.ids=[7011],e.modules={8013:e=>{e.exports=require("mongodb")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8358:(e,a,t)=>{t.r(a),t.d(a,{config:()=>w,default:()=>d,routeModule:()=>p});var s={};t.r(s),t.d(s,{default:()=>c});var r=t(1802),n=t(7153),i=t(6249),o=t(3919),u=t(9059),l=t(614);async function handler(e,a){let t;if("POST"!==e.method)return;let s=await (0,l.getToken)({req:e}),r="";e&&(r=e.headers.host);let n=!1;if((r===process.env.MAIN_HOST||r==="www."+process.env.MAIN_HOST)&&(n=!0),!n){a.status(200).json({ok:!0,status:500,error:"Service unavailable"});return}try{t=await (0,o.T)()}catch(e){a.status(200).json({ok:!0,status:500,error:"Connecting to the database failed."});return}let i=t.db(),c=await i.collection("users").findOne({username:"admin"});if(c.noSignup){if(s){if("admin"===s.name);else{await t.close(),a.status(200).json({ok:!0,status:500,error:"Service unavailable"});return}}else{await t.close(),a.status(200).json({ok:!0,status:500,error:"Service unavailable"});return}}let d=JSON.parse(e.body),w=d.username,p=d.email,m=d.password;if(!w||!p||!p.includes("@")||!m||m.trim().length<7){await t.close(),a.status(200).json({ok:!0,status:422,error:"Invalid input - password should be at least 7 characters long."});return}if("public"===w||"private"===w||"storage"===w){await t.close(),a.status(200).json({ok:!0,status:422,error:"Username already in use."});return}try{let e=await i.collection("users").findOne({username:w}),s=await i.collection("users").findOne({email:p});if(e){await t.close(),a.status(200).json({ok:!0,status:422,error:"Username already in use."});return}if(s){await t.close(),a.status(200).json({ok:!0,status:422,error:"Email already registered."});return}let r=await (0,u.c)(m);await i.collection("users").insertOne({username:w,email:p,password:r}),await i.collection("pages").insertOne({title:"Home - "+w,desc:"",slug:"",html:"",username:w,online:!0}),await i.collection("pages_published").insertOne({title:"Home - "+w,desc:"",slug:"",html:"",username:w}),await t.close(),a.status(200).json({ok:!0,status:201})}catch(e){await t.close(),a.status(200).json({ok:!0,status:500,error:"Unable to create user."})}}let c=handler,d=(0,i.l)(s,"default"),w=(0,i.l)(s,"config"),p=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/signup",pathname:"/api/auth/signup",bundlePath:"",filename:""},userland:s})},9059:(e,a,t)=>{t.d(a,{c:()=>hashPassword,G:()=>verifyPassword});let s=require("bcryptjs");async function hashPassword(e){let a=await (0,s.hash)(e,12);return a}async function verifyPassword(e,a){let t=await (0,s.compare)(e,a);return t}}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222,3919],()=>__webpack_exec__(8358));module.exports=t})();