"use strict";(()=>{var e={};e.id=2541,e.ids=[2541],e.modules={8013:e=>{e.exports=require("mongodb")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},6540:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var o=a(1802),n=a(7153),r=a(6249),i=a(2687),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,r.l)(i,"default"),l=(0,r.l)(i,"config"),d=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/sendcommand",pathname:"/api/sendcommand",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},2687:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>c});var o=a(3919),n=a(614),r=a(9648),i=e([r]);async function handler(e,t){let a;if("POST"!==e.method)return;let s=await (0,n.getToken)({req:e});if(!s){t.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let i=s.name;try{a=await (0,o.T)()}catch(e){t.status(200).json({ok:!0,status:500,error:"Connecting to the database failed."});return}try{let s=a.db(),o=await s.collection("users").findOne({username:i});if(!o){a.close(),t.status(200).json({ok:!0,status:401,error:"User not found."});return}let n=process.env.OPENAI_API_KEY,{question:c,context:u,system:l,functs:d,temperature:p,topP:m,num:h}=e.body;try{let e=await r.default.post("https://api.openai.com/v1/chat/completions",{model:"gpt-3.5-turbo",messages:[{role:"system",content:l},{role:"assistant",content:u||""},{role:"user",content:c}],temperature:parseFloat(p)||.6,top_p:parseFloat(m)||.9,n:parseInt(h)||1,functions:0===d.length?void 0:d},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),a=0===d.length?e.data:e.data.choices[0].message.function_call?e.data.choices[0].message.function_call.arguments:e.data.choices[0].message;t.json({answer:a})}catch(e){t.json({error:e.message})}}catch(e){await a.close(),t.status(200).json({ok:!0,status:500,error:"Something went wrong."})}}r=(i.then?(await i)():i)[0];let c=handler;s()}catch(e){s(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,3919],()=>__webpack_exec__(6540));module.exports=a})();