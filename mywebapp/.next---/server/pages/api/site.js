"use strict";(()=>{var e={};e.id=9166,e.ids=[9166],e.modules={8013:e=>{e.exports=require("mongodb")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8474:(e,a,t)=>{t.r(a),t.d(a,{config:()=>c,default:()=>m,routeModule:()=>d});var o={};t.r(o),t.d(o,{default:()=>u});var i=t(1802),n=t(7153),r=t(6249),s=t(3919),l=t(614);async function handler(e,a){let t;let o=await (0,l.getToken)({req:e});if(!o){a.status(200).json({ok:!0,status:401,error:"Not authenticated!"});return}let i=o.name;try{t=await (0,s.T)()}catch(e){a.status(200).json({ok:!0,status:500,error:"Connecting to the database failed."});return}if("POST"===e.method){let o=JSON.parse(e.body),n=o.domainName,r=o.favicon,s=o.trackingId,l=o.headerSlug,u=o.footerSlug,m=o.noSignup,c=o.customDomainOnly;try{let e=t.db(),o=await e.collection("users").findOne({username:i});if(o){let a;a="admin"===i?{$set:{favicon:r,trackingId:s,headerSlug:l,footerSlug:u,noSignup:m}}:{$set:{domainName:n,favicon:r,trackingId:s,headerSlug:l,footerSlug:u,noSignup:m,customDomainOnly:c}},await e.collection("users").updateOne({username:i},a)}await t.close(),a.status(200).json({ok:!0,status:200})}catch(e){await t.close(),a.status(200).json({ok:!0,status:500,error:"Something went wrong."})}}else try{let e=t.db(),o=await e.collection("users").findOne({username:i});if(!o){t.close(),a.status(200).json({ok:!0,status:401,error:"User not found."});return}let n="",r="",s="",l="",u="",m=!1,c="",d="",g="",p="",S="",f="",h="",w="",k=!1;o.domainName&&(n=o.domainName),o.favicon&&(r=o.favicon),o.trackingId&&(s=o.trackingId),o.headerSlug&&(l=o.headerSlug),o.footerSlug&&(u=o.footerSlug),o.noSignup&&(m=o.noSignup),o.customDomainOnly&&(k=o.customDomainOnly),o.mailSmtp&&(c=o.mailSmtp),o.mailPort&&(d=o.mailPort),o.mailUser&&(g=o.mailUser),o.mailPassword&&(p=o.mailPassword),o.mailFrom&&(S=o.mailFrom),o.mailName&&(f=o.mailName),o.captchaSiteKey&&(h=o.captchaSiteKey),o.captchaSecretKey&&(w=o.captchaSecretKey),"admin"===i&&(n=process.env.MAIN_HOST),await t.close(),a.status(200).json({ok:!0,status:200,domainName:n,favicon:r,trackingId:s,headerSlug:l,footerSlug:u,noSignup:m,customDomainOnly:k,mailSmtp:c,mailPort:d,mailUser:g,mailPassword:p,mailFrom:S,mailName:f,captchaSiteKey:h,captchaSecretKey:w})}catch(e){await t.close(),a.status(500).json({ok:!0,status:500,error:"Something went wrong."})}}let u=handler,m=(0,r.l)(o,"default"),c=(0,r.l)(o,"config"),d=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/site",pathname:"/api/site",bundlePath:"",filename:""},userland:o})}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222,3919],()=>__webpack_exec__(8474));module.exports=t})();